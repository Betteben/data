%5

bus = [ %% (Pd and Qd are specified in kW & kVAr here, converted to MW & MVAr below)
	1	2	0	0	0	0	1	1	0	12.66	1	1	1;
	2	1	100	60	0	0	1	1	0	12.66	1	1.1	0.9;
	3	1	90	40	0	0	1	1	0	12.66	1	1.1	0.9;
	4	1	120	80	0	0	1	1	0	12.66	1	1.1	0.9;
	5	1	60	30	0	0	1	1	0	12.66	1	1.1	0.9;
	6	1	60	20	0	0	1	1	0	12.66	1	1.1	0.9;
	7	1	200	100	0	0	1	1	0	12.66	1	1.1	0.9;
	8	1	200	100	0	0	1	1	0	12.66	1	1.1	0.9;
	9	1	60	20	0	0	1	1	0	12.66	1	1.1	0.9;
	10	1	60	20	0	0	1	1	0	12.66	1	1.1	0.9;
	11	1	45	30	0	0	1	1	0	12.66	1	1.1	0.9;
	12	1	60	35	0	0	1	1	0	12.66	1	1.1	0.9;
	13	1	60	35	0	0	1	1	0	12.66	1	1.1	0.9];
a=bus(:,3)/max(bus(:,3));
el=[1.6 1.25 1.05 0.85 0.80 1.05 1.25 1.40 1.75 2.1 2.55 3.05 3.2  3.1 2.9 2.25 2.45 2.80 3.55 3.8 3.95 3.85 3.65 2];
el=el/max(el);
EPLOAD=(a*el)*0.45;%每个节点上的电负荷
% plot(sum(EPLOAD))
BRANCH = [ 1	2	0.6922	0.0470	0	0	0	0	0	0	1	-360	360;
	1	3	0.4930	0.2511	0	0	0	0	0	0	1	-360	360;
	1	5	0.3660	0.1864	0	0	0	0	0	0	1	-360	360;
	2	4	0.3811	0.1941	0	0	0	0	0	0	1	-360	360;
	3	6	0.8190	0.7070	0	0	0	0	0	0	1	-360	360;
	5	7	0.1872	0.6188	0	0	0	0	0	0	1	-360	360;
	6	8	0.7114	0.2351	0	0	0	0	0	0	1	-360	360;
	6	11	1.0300	0.7400	0	0	0	0	0	0	1	-360	360;
	7	9	1.0440	0.7400	0	0	0	0	0	0	1	-360	360;
	7	10	0.1966	0.0650	0	0	0	0	0	0	1	-360	360;
	7	12	0.3744	0.1238	0	0	0	0	0	0	1	-360	360;
    11	13	0.3744	0.1238	0	0	0	0	0	0	1	-360	360;];
% BRANCH(:,3) = BRANCH(:,3)*1/(12.66^2);%求阻抗标幺值

nb=13;%节点
nl=12;%支路
R=BRANCH(:,3);
X=BRANCH(:,4);
upstream=zeros(nb,nl);%%流出
dnstream=zeros(nb,nl);%%流入
upstream_doc=[1 1 1 2 3 5 6 6 7 7 7 11];k=1;%父点
for i=upstream_doc
upstream(i,k)=1;
k=k+1;
end
dnstream_doc=[2 3 5 4 6 7 8 11 9 10 12 13];k=1;%子点
for i=dnstream_doc
dnstream(i,k)=1;
k=k+1;
end


%% cost
Cel=0.14*1e3;%电解槽成本
Cfc=0.01*1e3;%燃料电池
Ces=0.1*1e3;%储能%%
Chs=0.04*1e3;%储氢
Cqfqg=10*1e3;%弃风
Cdg=1.4*1e3;%柴油发电机
Csu=0.2*1e3;%电解槽启动成本
Csd=0.2*1e3;%电解槽停止成本
Cde=0.1*1e3;%成本
%% 
pdgmax=3;%柴油机
pdgmin=0.05*pdgmax;
% ELE
Pelmax=4;%电解槽
Pelmin=Pelmax*0.1;
% FC
Pfcmax=3;%燃料电池
Pfcmin=0.1*Pfcmax;
% HES
Shesmax=30;%储氢罐
Shesmin=6;
%Phssmax=1.500;
% ESS
Sessmax=1;%电储能
Sessmin=0.2;
Pessmax=0.5;
Pessmin=0;
%% efficiency 
nfc=0.7;
nhesdis=0.9;
nhesch=0.9;
neesdis=0.98;
neesch=0.98;
nde=0.0007;
%% 
PW=0.14*[9.24800000000000	9.94200000000000	10.4000000000000	10.2340000000000	10.1680000000000	9.96800000000000	9.78200000000000	9.46200000000000	5.30400000000000	3.47600000000000	2.15800000000000	2.03000000000000	2.76800000000000	4.12200000000000	4.11600000000000	4.99600000000000	5.49000000000000	5.60200000000000	5.68400000000000	5.68600000000000	5.17600000000000	4.78600000000000	4	4.26800000000000];
HPLOAD(1,:)=0.4*[0.5	0.57142857142857	0.46428571428571	0.35714285714286	0.25000000000000	0.33571428571429	0.72857142857143	0.82142857142857	0.91428571428571	1.30714285714286	1.50000000000000	2.39285714285714	2.28571428571429	2.12500000000000	1.57857142857143	1.18571428571429	1.13928571428571	1.39285714285714	2.34642857142857	2.60000000000000	2.35357142857143	2.28571428571429	1.60714285714286	1.62857142857143];
HPLOAD(2,:)=0.4*[0.4	0.447142857142857	0.34428571428571	0.37714285714286	0.22000000000000	0.31571428571429	0.82857142857143	0.88142857142857	0.95428571428571	1.50714285714286	1.30000000000000	2.59285714285714	2.38571428571429	2.02500000000000	1.87857142857143	1.48571428571429	1.33928571428571	1.29285714285714	2.14642857142857	2.30000000000000	2.45357142857143	2.88571428571429	1.20714285714286	1.22857142857143];


%% 
Req=zeros(nl,nl);%nl 行 nl 列的零矩阵
aij=[1	0	1	0	0	0	0	0	0	0	0	0
0	1	0	0	1	0	1	0	0	1	0	1
0	0	0	1	0	1	0	1	1	0	1	0
0	0	1	0	0	0	0	0	0	0	0	0
0	0	0	0	1	0	1	0	0	1	0	1
0	0	0	0	0	1	0	1	1	0	1	0
0	0	0	0	0	0	1	0	0	0	0	0
0	0	0	0	0	0	0	0	0	1	0	1
0	0	0	0	0	0	0	1	0	0	0	0
0	0	0	0	0	0	0	0	1	0	0	0
0	0	0	0	0	0	0	0	0	0	1	0
0	0	0	0	0	0	0	0	0	0	0	1];%行是节点，列是线路
R1=R;
for i=1:nl
Req(i,i)=R1(i);
end
%% dnamic hydrogen production efficiency
Uref=1.23;
R=8.31;
T = 335.15;        
F = 96485;               
PH2=29.8;
PO2=2.8;
AH20=1;
RCELL=0.12;AAN=2;IAN=1e-6;ACAT=0.5;ICAT=1e-3;Acell=1100;
NE=1;
K=13;
hhv=33.3;
kesai_difh2=4.65;kesai_difo2=2;kesai_dph2=2;
ph2=29.8+2.4*icell*(1+kesai_dph2/kesai_difh2);po2=2.8+2.8*icell;d=0.01;